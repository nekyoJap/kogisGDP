あなたはセキュリティアーキテクト兼DDDを理解したシステムアーキテクトです。\
以下の【形式】および【ISO/IEC Directives Part 2準拠ルール】に基づいて、対象システムの「APIガバナンス方針書」を作成してください。\
出力はすべてMarkdown形式で記載してください（JSON形式・CSV形式は禁止）。\
また、成果物（表・文章）の提示より先に、必ず抽出・推論過程をstep-by-stepで記載し、\
その後に章立てに沿って成果物を順序厳守で出力してください。\
推測による情報補完は禁止し、不明点は必ず「未確定」と明記してください。\
また、入力情報が不足している場合や検討が必要な論点がある場合は、文書の末尾に「Stop（入力不足に対する質問）」「論点（検討が必要な事項）」セクションを出力してください。

---

### 【形式】

章：`## 第1章 タイトル`\
節：`### 1.1 タイトル`\
項：`#### 1.1.1 タイトル`\
その他：通常テキスト\
表はMarkdown表形式で記載し、表番号とキャプションを付与する（例：`**表1 — 〇〇一覧**`）\
JSON / CSV形式は禁止

---

### 【ISO/IEC Directives Part 2準拠ルール】

#### 要求事項の表現
出力文書では以下の表現を使い分けること：

| 表現 | 用途 | 英語対応 |
|------|------|----------|
| 〜しなければならない | 要求事項 | shall |
| 〜してはならない | 禁止事項 | shall not |
| 〜することが望ましい | 推奨事項 | should |
| 〜しないほうがよい | 非推奨 | should not |
| 〜してもよい | 許可事項 | may |
| 〜できる | 可能性・能力 | can |

#### 文書構成の原則
- 要求事項と説明・解説を明確に区別すること
- 各章・節には目的を明示すること
- 表には連番とキャプションを付与すること

---

## 第1章 適用範囲

### 1.1 目的

本書は、ハウスクレジット基幹システムにおける全API（同期API／非同期API／イベントAPI／バッチAPI／BFF／Process API／External Public API／ファイル連携API）の設計・運用・保守・廃止に関する共通ルールおよび判断基準を定義し、\
境界づけられたコンテキスト（BC）単位の自律性と、システム全体の整合性の両立を図ることを目的とする。

### 1.2 適用範囲

本書は「システム全体方針検討」に属するアーキテクチャ指針であり、コンテキストマップ／ドメインスコープ定義書／構成・運用方針書をインプットとして作成される。\
本書はAPI仕様そのものではなく、「APIをどのように設計・管理・公開するか」のメタルールを定める。\
個々のAPI仕様（OpenAPI／AsyncAPI／Batch仕様など）は、本書の方針に従って別途作成・管理しなければならない。

**表1 — 適用範囲**
| 項目 | 記述内容 |
|----|------|
| 対象システム | ハウスクレジット基幹システム |
| 対象BC | ドメインスコープ定義書およびコンテキストマップに定義された全BC |
| 除外対象 | 未確定（PoC／一時検証APIは例外承認対象とする想定だが詳細運用ルールは未確定） |

### 1.3 関連文書

**表2 — 関連文書一覧**
| 関連ドキュメント | 関係性 |
|----------------|--------|
| コンテキストマップ | BC構造・BC間関係の定義をインプットとする |
| ドメインスコープ定義書 | BC境界の定義をインプットとする |
| 構成・運用方針書 | インフラ・運用要件と整合する |
| セキュリティ方針書 | セキュリティ要件と整合する |
| 認証・認可方針書 | 認証・認可方式と整合する |
| 非同期連携方針書 | イベント駆動連携の詳細を参照する |

---

## 第2章 引用規格

本書は以下の規格・標準を参照する：

- OpenAPI Specification 3.0
- AsyncAPI Specification 2.0
- RFC 7231 HTTP/1.1 Semantics and Content
- RFC 6749 OAuth 2.0 Authorization Framework

---

## 第3章 用語及び定義

本書で使用する主要な用語を以下に定義する：

**表3 — 用語定義**
| 用語 | 定義 |
|------|------|
| Domain API | 単一BC内部で完結する操作を提供するAPI |
| Process API | BC横断の業務フロー・オーケストレーションを担うAPI |
| BFF | Backend for Frontend。UI最適化・プレゼンテーション層専用のAPI |
| External Public API | 外部システム・パートナー向けに公開されるAPI |
| Event API | 状態変化をイベントとして通知するAPI（Pub-Sub） |
| Batch API | 定期実行・ファイル連携などバッチ処理用のAPI |
| ACL | Anti-Corruption Layer。外部との連携時に自BCモデルを保護する翻訳層 |

---

## 第4章 入力情報と前提

### 4.1 入力アセット

以下の正式インプットを前提とする（添付資料に基づく）：

### 4.2 前提条件

* 本方針書は、「コンテキストマップ」「ドメインスコープ定義書」「構成・運用方針書」など、BC構造およびシステム全体構成が定義された資料を前提とする。
* APIは、DDDのBounded Context単位でモデリングされたドメイン構造に基づき設計されることを前提とし、BC一覧およびユビキタス言語定義は別途ドキュメントで管理される。
* 本方針書は「APIの設計・管理・公開」に関するメタルールを対象とし、個々のAPI仕様（OpenAPI／AsyncAPI／Batch仕様／ファイル仕様等）の詳細は、各API仕様書で定義されることを前提とする。
* 認証・認可、ゼロトラスト、ネットワーク境界、暗号化方式などのセキュリティ要件は、「セキュリティ方針」「セキュリティ非機能要件定義書」「認証・認可方針書」にて定義され、本方針書はそれらと整合して運用される。
* 可用性・性能・スループット・レートリミット等の数値基準は、「非機能要件定義書」「性能定義書」で定義され、本方針書ではそれらの値を満たす設計・実装を行うことを前提とする。
* ログ・監査・メトリクス・トレースなどの可観測性要件は、「ロギング／監査方針書」「運用要件定義書」「監査・業務ログ一覧」等で定義され、本方針書ではAPIレベルでそれらを満たすように設計することを前提とする。
* 外部システムとのインタフェース要件（銀行口座振替API、外部信用情報機関、会計システム等）は、各外部仕様書および連携方針書にて定義され、本方針書はそれらとの契約をAPIガバナンスの対象として扱うことを前提とする。

---

## 第5章 対象BC一覧

コンテキストマップより抽出した対象BC一覧を以下に示す。

**表4 — 対象BC一覧**
| No. | ドメイン | サブドメイン | BC | BC概要 |
|----|------|--------|----|------|
| 1 | 売上管理 | 売上取込 | 売上取込BC | ブランド/ネットワークからの売上受入・重複/形式チェック。 |
| 2 | 売上管理 | 売上確定 | 売上確定BC | 審査後の売上確定・取消制御・請求連携の起点。 |
| 3 | 売上管理 | オーソリ反映 | オーソリ反映BC | オーソリ結果・解約等に伴う即時利用可否反映。詳細未確定。 |
| 4 | 会員精算管理 | 請求管理 | 請求BC | サイクル集計・請求締め・会計連携候補の生成。 |
| 5 | 会員精算管理 | 入金管理 | 入金BC | 口座振替/全銀振込の結果取込・消込・未収管理。 |
| 6 | 会員精算管理 | 返金処理 | 返金BC | 返金起案/承認/実行と結果反映。 |
| 7 | ポイント管理 | ポイント管理 | ポイントBC | 売上連携によるポイント付与/利用/失効・履歴管理。 |
| 8 | 審査発行管理 | 与信審査 | 審査BC | 申込〜eKYC/信用照会〜審査判定。 |
| 9 | 審査発行管理 | カード発行 | 発行BC | 発番・印刷・発送・受領管理。 |
| 10 | 加盟店契約管理 | 契約/審査 | 加盟店契約BC | 加盟店申請→名寄せ→登録、属性/契約変更・停止/解約。 |
| 11 | 加盟店契約管理 | 契約/審査 | 加盟店審査BC | 加盟店審査・外部信用情報機関への照会。 |
| 12 | 会計統合管理 | 日計/会計連携 | 日計管理BC | 仕訳基準・日計管理。 |
| 13 | 会計統合管理 | 日計/会計連携 | 会計連携BC | 会計連携用I/F加工（外部会計システム連携）。 |
| 14 | 共通運用管理 | 共通マスタ/日付 | 共通マスターBC | 住所・金融・コード・休日など共通マスタ。全ドメイン参照。 |
| 15 | 共通運用管理 | 共通マスタ/日付 | 運用日付BC | システム日付等の運用日付管理。 |
| 16 | 顧客管理 | 顧客 | 顧客BC | 顧客基本情報管理。詳細未確定。 |
| 17 | 顧客管理 | 連絡先・住所 | 連絡先・住所BC | 顧客の連絡先・住所情報管理。共通マスターBCとShared Kernel。 |
| 18 | 顧客管理 | 解約 | 解約BC | 解約登録・利用停止トリガ管理。 |

---

## 第6章 APIの定義と分類

### 6.1 APIの定義

本書における「API」とは、次のすべてを含む広義のインタフェースと定義する。

* システム間・BC間の機能・データを**契約（Contract）**として公開し、連携するためのインタフェース全般
* HTTP/REST API、RPC、GraphQL、メッセージング／イベント配信（Kafka等）、バッチ連携、ファイル連携（CSV／XML／固定長など）、SFTP連携等を含む

### 6.2 API種別とガバナンス対象

**表5 — API種別とガバナンス対象**
| API種別 | 含まれる対象例 | ガバナンス上の扱い |
|-----------|------------------|-----------|
| Domain API | 売上確定BCの確定・取消操作、請求BCの請求締め操作 等 | 集約単位・ユースケース単位で契約を定義し、仕様レビュー対象としなければならない |
| Process API | 売上確定→請求生成フロー、審査承認→発行フローなどBC横断処理 | 複数BCや外部APIのオーケストレーション・例外処理・統合フロー管理を担う |
| BFF | Web/アプリ向け会員請求照会API、ポイント照会画面用API 等 | UI最適化・プレゼンテーション層専用。ビジネスロジックを含んではならない |
| External Public API | 銀行口座振替APIとの連携I/F、外部信用情報機関照会I/F、加盟店向け売上照会API 等 | セキュリティ／SLA／公開レベル（Public/Partner/Internal）の管理対象とする |
| Event API | 売上確定イベント、請求確定イベント、入金結果イベント 等 | イベントスキーマ定義・発生契機・Pub-Sub契約の管理対象とする |
| Batch API / File連携 | 会計連携用バッチIF、全銀振込結果ファイル取込、日計出力 等 | スキーマ／受渡方式／再処理条件／ファイル形式の契約として扱う |

上記はすべてAPI契約として扱い、本方針の適用対象としなければならない。\
具体的なプロトコルやフォーマットは一部未確定とし、別途仕様で定義する。

---

## 第7章 API基本方針（DDD/BCとの関係）

### 7.1 DDD／コンテキストマップとの整合

#### 7.1.1 APIとBC境界の基本原則

**表6 — APIとBC境界の基本原則**
| 原則 | 説明 |
|----|----|
| 境界尊重 | APIは、BC内部のドメインモデルを他BCに直接公開してはならない。必要に応じてACL／翻訳層（Anti-Corruption Layer）を設けなければならない |
| 責務分離 | Domain APIは単一BC内部で完結する操作のみを提供し、BC横断の責務はProcess APIに委任しなければならない |
| ユビキタス言語整合 | APIで使用する語彙は、各BCのユビキタス言語およびVO辞書と整合させなければならない |
| アーキテクチャ適合 | API設計はコンテキストマップで定義された関係（ACL／Shared Kernel／Separate Ways 等）と整合していなければならない |

#### 7.1.2 API種別とBC境界の対応

**表7 — API種別とBC境界の対応**
| API種別 | BCとの関係 | 設計上の注意点 |
|-------|--------|---------|
| Domain API | 単一BC内 | 1つのBC内部のユースケースを集約単位で提供する。BC内部境界を越えてはならない |
| Process API | BC横断 | BC間のオーケストレーションを実装する。リトライ／補償処理もProcess API側で管理しなければならない |
| BFF | BC境界外 | 顧客向けUI／加盟店向けUIのための集約ビュー提供に特化し、ビジネスルールはBCまたはProcess API側に保持しなければならない |
| External Public API | BC外部 | ACLパターンに従いBC外部の境界として扱わなければならない |
| Event API | BC横断（疎結合） | 状態変化をイベントとして発行し、他BCが購読する構造を想定する |
| Batch API | BC横断／外部 | 定期連携やファイル受渡しを担当する。再処理条件やファイル管理は契約に明示しなければならない |

#### 7.1.3 コンテキストマップとの整合ルール

API設計時には、必ずコンテキストマップを参照し、以下を確認しなければならない。

**表8 — コンテキストマップ整合確認項目**
| 確認項目 | 説明 |
|------|----|
| 境界タイプの確認 | コンテキスト間の関係がACL／Shared Kernel／Separate Waysのどれに該当するかを明確にしなければならない |
| モデル依存の確認 | 他BCのドメインモデルを直接参照する必要がある場合はShared KernelかACLかを判断しなければならない |
| イベント共有の可否 | イベント共有が発生する箇所について、イベント形式とVOの整合性を保証しなければならない |
| 変更影響管理 | API変更が他BCまたは外部システムに影響を与える場合、影響範囲を洗い出しレビューを行わなければならない |

### 7.2 API種別ごとの責務・設計原則

**表9 — API種別ごとの責務・設計原則**
| API種別 | 責務 | 設計原則 |
|-------|----|------------------|
| Domain API | 集約／ユースケース | 集約の不変条件を守り、DDDモデルと整合したAPI設計でなければならない。1つのDomain APIで複数BCの責務を扱ってはならない |
| Process API | 業務フロー | BC横断の調整を担い、業務フロー単位で契約を定義しなければならない。Saga／補償トランザクション等の制御もProcess API側で明確化しなければならない |
| BFF | UI適合 | UI専用APIとして、ビジネスロジックを含んではならない。レスポンス整形・集約・フィルタリングなどプレゼンテーションロジックに限定しなければならない |
| External Public API | 外部提供 | 公開レベル（Public／Partner／Internal）を区分管理しなければならない。契約やSLA、利用制約を明示しなければならない |
| Event API | 状態通知 | イベント名・契機はイベントストーミング定義と整合しなければならない。重要イベントについてはバージョニングとスキーマ進化方針を定めなければならない |
| Batch API | データ交換 | ファイル形式とスキーマ、検証、再処理条件を含む契約を明示しなければならない |

---

## 第8章 APIライフサイクル管理方針

### 8.1 ライフサイクルフェーズ

**表10 — APIライフサイクルフェーズ**
| フェーズ | 説明 | 必須アウトプット |
|------|----|----------|
| 企画 | API追加の目的・ビジネス価値を明確化し、API種別を判定する | API企画書（テンプレート・必須項目は未確定） |
| 設計 | API契約（仕様）を定義し、形式と公開レベルを設計する。仕様書はレビューを完了しなければならない | API仕様書 |
| 実装・テスト | API仕様に基づいて実装し、機能・性能・セキュリティ要件を検証しなければならない | 実装コード、テスト結果 |
| リリース | 本番環境へのデプロイと公開範囲の設定を行い、APIポートフォリオを更新しなければならない | リリース記録、APIカタログ更新記録 |
| 廃止 | API廃止やバージョン削除に際し、利用者への通知・移行期間・代替APIを定義しなければならない | 廃止計画・告知記録 |

### 8.2 バージョニング方針

**表11 — バージョニング方針**
| 項目 | 要求事項 |
|----|------|
| バージョン表現 | URI / ヘッダ / メッセージ形式のいずれかによる表現方式は未確定とし、プロジェクトで統一ルールを定義しなければならない |
| 後方互換 | 互換性を破る変更はメジャーバージョンアップとし、旧バージョンは移行期間中並行提供しなければならない（具体期間は未確定） |
| 廃止告知 | 廃止時は、少なくとも未確定期間以上前に利用者（内部・外部）に通知しなければならない |
| スキーマ進化 | 後方互換な修正（フィールド追加等）は、スキーマの互換性検証を通過しなければならない |

---

## 第9章 API仕様標準方針

### 9.1 仕様形式・管理方法

**表12 — 仕様形式・管理方法**
| 項目 | 記述内容 |
|----|------|
| 仕様形式 | OpenAPI / AsyncAPI / GraphQL SDL / Batch仕様（契約書形式）等から採用形式を選定し、本書に明記しなければならない。現時点の採用形式は未確定 |
| 管理リポジトリ | API仕様はGit等のバージョン管理システムで管理し、変更履歴を追跡可能としなければならない |
| レビュー要件 | API仕様の新規作成・変更は必ずレビューを通過しなければならない。具体ロールは未確定 |

### 9.2 命名規約・URI設計

**表13 — 命名規約・URI設計**
| 項目 | 要求事項 |
|----|------|
| ベースパス | システム全体で統一されたベースパス方針を定めなければならない。具体値は未確定 |
| リソース名 | ケバブケース・複数形などプロジェクト標準に従って統一しなければならない。ドメインのユビキタス言語と整合していること |
| フィールド名 | ユビキタス言語VO定義書に基づき命名しなければならない |
| ステータスコード | HTTPステータスコードの利用ルール（2xx, 4xx, 5xxの使い分け）を定義し、それに従わなければならない |

---

## 第10章 APIセキュリティ・アクセス制御方針

本章は「セキュリティ方針」「セキュリティ非機能要件定義書」の参照が主であり、API固有の補足のみを記載する。

### 10.1 認証・認可の適用

**表14 — 認証・認可の適用**
| 項目 | 要求事項 |
|----|------|
| 認証方式 | 具体的な方式（OIDC／OAuth2.0／Mutual TLS／Basic認証等）はセキュリティ方針を参照すること。外部公開APIは認証必須としなければならない |
| 認可スコープ | API単位で必要な権限（読取／更新／管理等）を定義し、API仕様書に明示しなければならない |
| ゼロトラスト | 内部APIであっても、ネットワーク境界やBC境界を越える通信には認証と認可を適用しなければならない |

### 10.2 伝送路・入力検証

**表15 — 伝送路・入力検証**
| 項目 | 要求事項 |
|----|------|
| 通信経路の保護 | TLS等の暗号化方式はセキュリティ方針を参照し、すべてのAPI通信がその要件を満たさなければならない |
| 入力検証 | API入力はスキーマに基づいてサーバ側で検証し、不正入力を拒否しなければならない |
| 機微情報の取扱い | 個人情報・金融情報等の機微データのマスキング／ログ抑止／暗号化要件はセキュリティ方針を参照しなければならない |

---

## 第11章 API品質・非機能方針

数値基準は「非機能要件定義書」「性能定義書」を参照すること。

### 11.1 性能・可用性・スロットリング

**表16 — 性能・可用性・スロットリング**
| 項目 | 要求事項 |
|----|------|
| 性能基準の参照 | 各APIは非機能要件定義書の性能目標を参照し、それに基づき設計しなければならない |
| スロットリング | 外部公開APIに対してはスロットリング／レートリミット方針を定義しなければならない（具体値は未確定） |
| 可用性 | 可用性の目標値は性能定義書に従い、本書では「当該値を満たす設計義務」を定める |

### 11.2 可観測性・ログ

**表17 — 可観測性・ログ**
| 項目 | 要求事項 |
|----|------|
| メトリクス | APIリクエスト数、エラー率、レイテンシ等を収集しなければならない |
| トレース | 分散トレーシングの適用有無は未確定とし、適用する場合は全APIで一貫性を持たせなければならない |
| ログ方針 | APIアクセスログ・監査ログの項目・保管期間はロギング／監査方針書を参照しなければならない |

---

## Stop（入力不足に対する質問）

（入力情報が不足している場合、ここに質問を記載する）

---

## 論点（検討が必要な事項）

（検討が必要な論点がある場合、ここに記載する）
