---
id: DMPZZZZ001
title: データモデリング方針書
sidebar_position: 1
---

# データモデリング方針書

| 項目 | 内容 |
|------|------|
| ドキュメントID | DMPZZZZ001 |
| 版数 | 1.0 |
| 作成日 | 2026-01-15 |
| 最終更新日 | 2026-01-15 |
| ステータス | ドラフト |

---

## 第1章 適用範囲

### 1.1 目的

本ドキュメントは、ハウスクレジット基幹システムにおけるデータモデリングの共通方針を定め、各BC単位で作成される以下のドキュメント群に対し、上位方針として拘束力を持つことを目的とする。

- ドメインモデル概要書／集約一覧／集約仕様書
- リポジトリ一覧／リポジトリ仕様書
- テーブル一覧／テーブル仕様書
- プロジェクション一覧／プロジェクション仕様書

本書で定義された方針に反するデータモデル・テーブル設計を行ってはならない。

### 1.2 適用範囲

**表1 — 適用範囲**

| 項目 | 内容 |
|------|------|
| ドキュメント名 | データモデリング方針書 |
| 単位 | 全体（全BC共通） |
| 位置づけ | データ設計に関する最上位方針ドキュメント |
| 主な参照先 | ドメインスコープ定義書、コンテキストマップ、トランザクション方針書、アプリケーションログ方針書、セキュリティ方針書 |

### 1.3 前提アーキテクチャ

本方針書は、DDD（ドメイン駆動設計）に基づくレイヤードアーキテクチャを前提とし、ドメインモデル（集約／エンティティ／VO）、永続化モデル、ビュー／プロジェクションの三層に適用される。

本方針書は、「ドメインスコープ定義書」「コンテキストマップ」で定義された全てのBCを適用対象とし、Core／Supporting／Genericの種別に関わらず統一的に適用しなければならない。

データモデリングに関するより詳細な仕様（項目一覧・型・制約・インデックス等）は、テーブル仕様書およびリポジトリ仕様書にて定義しなければならない。

**表2 — 適用対象**

| 区分 | 内容 |
|------|------|
| 適用対象 | 全BCのデータモデル（集約モデル／永続化モデル／プロジェクション） |
| 非適用（参照） | トランザクション制御、ログ出力フォーマット、インフラ構成 |
| 前提アーキテクチャ | DDD＋BC単位マイクロサービス（予定） |

### 1.4 関連文書

**表3 — 関連文書一覧**

| 関連ドキュメント | 関係性 |
|------------------|--------|
| ソフトウェアアーキテクチャ方針書 | DDD・クリーンアーキテクチャの詳細を参照 |
| ドメインスコープ定義書 | BC構造・境界の定義をインプットとする |
| コンテキストマップ | BC間関係の定義をインプットとする |
| トランザクション方針書 | トランザクション境界・整合性方針を参照 |
| セキュリティ方針書 | データ分類・暗号化方針を参照 |
| アプリケーションログ方針書 | 監査証跡方針を参照 |

---

## 第2章 引用規格

本書は以下の規格・標準を参照する：

- ISO/IEC 11179 メタデータレジストリ
- Domain-Driven Design (Eric Evans)
- Implementing Domain-Driven Design (Vaughn Vernon)

---

## 第3章 用語及び定義

本書で使用する主要な用語を以下に定義する。

**表4 — 用語定義**

| 用語 | 定義 |
|------|------|
| 集約（Aggregate） | 整合性境界を形成するエンティティ・VOの集まり |
| 集約ルート | 集約への唯一のアクセスポイントとなるエンティティ |
| エンティティ | 識別子を持ち、ライフサイクルを通じて同一性が維持されるオブジェクト |
| VO（Value Object） | 識別子を持たず、属性の組み合わせで同一性が判定されるオブジェクト |
| プロジェクション | 参照用途に最適化された非正規化ビュー |
| サロゲートキー | ビジネス上の意味を持たない技術的識別子 |
| 自然キー | ビジネス上の意味を持つ識別子（カード番号、会員番号等） |
| リポジトリ | 集約の永続化・取得を担う抽象 |

---

## 第4章 データモデリング共通方針

### 4.1 モデルレイヤ分離方針

データモデルは、少なくとも以下のレイヤに分離して定義しなければならない。

**表5 — モデルレイヤ定義**

| レイヤ | 説明 | 主な記述ドキュメント |
|--------|------|---------------------|
| ドメインモデル | 業務ロジックの一貫性境界（集約単位）を表現 | ドメインモデル概要書／集約仕様書 |
| 永続化モデル | DB上の物理／論理構造 | テーブル一覧／テーブル仕様書／リポジトリ仕様書 |
| プロジェクション | 参照用途に最適化された冗長ビュー | プロジェクション一覧／仕様書 |

#### 4.1.1 レイヤ分離の原則

**表6 — レイヤ分離原則**

| 原則 | 説明 |
|------|------|
| ドメインモデル独立性 | ドメインモデルは永続化技術に依存してはならない |
| マッピング明示 | ドメインモデルと永続化モデルの乖離がある場合、リポジトリでマッピングを明示しなければならない |
| プロジェクション読み取り専用 | プロジェクションは読み取り専用とし、更新は必ず集約経由で行わなければならない |

ドメインモデルと永続化モデルの乖離が必要な場合、乖離理由（性能要件、外部IF制約等）をリポジトリ仕様書に明示しなければならない。

プロジェクション／ビュー用の冗長なデータ構造は、読み取り専用であることを明示し、更新は必ず集約経由で行わなければならない。

### 4.2 BC・集約とデータモデルの対応方針

#### 4.2.1 BCとデータモデルの対応

各BCは、コンテキストマップで定義された整合境界に従い、BCをまたぐテーブル共有を原則禁止しなければならない。

**表7 — BC・集約とデータモデルの対応**

| 対応関係 | 方針 |
|---------|------|
| BC ↔ スキーマ | 1 BC = 1 もしくは少数の論理スキーマを原則とし、スキーマ共有は例外として扱う |
| 集約 ↔ テーブル群 | 集約ルートごとに永続化ルートを定義し、BC内に閉じた整合性を確保する |
| BC間 | イベント／API経由での連携のみ許容する |

#### 4.2.2 集約とテーブルの対応

1つの集約は、原則として1つの永続化ルート（テーブルまたはドキュメント）を持つものとし、複数テーブルに跨る場合は、同一BC内で完結するように設計しなければならない。

BC間のデータ連携は、イベント／API／外部連携一覧で定義されたインタフェースを通じてのみ行い、同一DBスキーマへのクロスBC直接参照を禁止しなければならない。

### 4.3 命名規約・識別子・キー選定

#### 4.3.1 識別子の設計

すべての集約ルートおよび主要エンティティは、ドメイン上の自然キーと独立した技術的識別子（サロゲートキー）を持たなければならない。

技術的識別子は、BCを跨いで一意である必要はないが、当該BC内では一意となるよう設計しなければならない。

**表8 — 命名規約・識別子方針**

| 対象 | 方針 |
|------|------|
| 集約ルートID | BC内で一意な技術ID（数値 or UUID 等）を必須とする |
| 自然キー | ビジネス上のキー（カード番号、会員番号等）は別VOとして保持する |
| 命名 | ユビキタス言語を優先し、システム固有略語を禁止する |
| 一貫性 | BC内で同じ概念には同じ名称を使用しなければならない |

#### 4.3.2 命名規約

テーブル・カラムの命名規約は「ユビキタス言語／VO定義書」で定義された用語に基づき、略語や多義的な名称を使用してはならない。

**表9 — 命名規約詳細**

| 項目 | 規約 |
|------|------|
| テーブル名 | 集約名または概念を表す名詞（単数形）を使用する |
| カラム名 | VOまたは属性名と整合させる |
| 主キー | `{テーブル名}_id` または `id` を使用する |
| 外部キー | 参照先テーブル名を含める（例：`customer_id`） |
| 日時カラム | `created_at`, `updated_at` 等の統一した命名を使用する |

---

## 第5章 データ永続化方針（履歴・改訂・整合性）

### 5.1 履歴管理・改訂方針

発券済カード情報・限度額情報など、後続ドメイン（売上・請求・債権）に影響する確定データは、原則として履歴追記方式を採用し、確定済レコードの上書き更新を禁止しなければならない。

**表10 — 履歴管理方針**

| 対象データカテゴリ | 履歴方式 | 備考 |
|-------------------|---------|------|
| カード／契約状態 | 有効期間管理＋履歴追記 | 状態変更の履歴を保持 |
| 限度額 | 有効期間管理＋履歴追記 | 過去限度の追跡が可能であること |
| マスタ（コード等） | 案件に応じて選択 | 参照系のみの場合は履歴不要も可 |
| 取引データ | イミュータブル（追記のみ） | 更新・削除は原則禁止 |

#### 5.1.1 履歴テーブルの設計

履歴管理が必要なテーブルは、有効開始日／終了日、改訂理由、改訂者等の監査項目を保持するようモデリングしなければならない。

履歴テーブルと現行テーブルを分離する場合、その対応関係をテーブル仕様書に明示しなければならない。

**表11 — 履歴テーブル必須項目**

| 項目 | 説明 |
|------|------|
| valid_from | 有効開始日時 |
| valid_to | 有効終了日時（NULL=現行） |
| revision_reason | 改訂理由 |
| revised_by | 改訂者 |
| revised_at | 改訂日時 |

### 5.2 整合性・参照制約方針

#### 5.2.1 参照制約の適用範囲

外部キー制約は、BC内の整合性担保に限定して利用し、BC間の参照はアプリケーションレベルの整合性により担保しなければならない。

**表12 — 整合性・参照制約方針**

| 区分 | 方針 |
|------|------|
| BC内FK | 積極的に利用し、一貫性をDB制約で担保する |
| BC間FK | 原則禁止。BC間はイベント／APIを通じた整合性とする |
| 不変条件 | 可能な限りDB制約＋ドメインルールの二重防御とする |

#### 5.2.2 不変条件の実装

Invariant（不変条件）は、可能な限りデータモデル上の制約（NOT NULL、UNIQUE、CHECK 等）で表現し、それが困難な場合はドメインサービス／アプリケーションサービスでの検証ルールとして定義しなければならない。

**表13 — 不変条件実装方針**

| 実装レベル | 適用場面 | 例 |
|-----------|---------|-----|
| DB制約 | 単純な制約 | NOT NULL, UNIQUE, CHECK |
| ドメインロジック | 複雑なビジネスルール | 集約内の整合性検証 |
| アプリケーションロジック | 集約を跨ぐルール | 複数集約の状態確認 |

### 5.3 削除・アーカイブ方針

#### 5.3.1 論理削除と物理削除

論理削除フラグを利用する場合は、削除レコードを除外したいユースケースにおいて必ず条件句に含めるよう、リポジトリ仕様書／クエリ仕様書に明記しなければならない。

**表14 — 削除・アーカイブ方針**

| 項目 | 方針 |
|------|------|
| 論理削除 | 保管義務のあるデータの基本方式とする |
| 物理削除 | 法令等で削除義務があるデータに限定する |
| アーカイブ | 性能・容量要件に応じて別スキーマ／別ストレージに退避する |

#### 5.3.2 削除の実装指針

監査／法規制に関わるデータは、保管期間満了までは論理削除を原則とし、物理削除を行ってはならない。

物理削除が認められるのは、個人情報保護等の観点で削除義務があるデータに限定し、その対象・条件をテーブル仕様書で明示しなければならない。

大量データの長期保管が必要な場合、アーカイブ用ストレージ／スキーマへの移送方針を別途定義し、その前提条件を本書に記載しなければならない。

---

## 第6章 セキュリティとアクセス制御（データ観点）

### 6.1 データ分類・マスキング

データは、セキュリティ方針書で定義される情報分類（例：特定個人情報／決済機密情報／個人情報等）に従って分類し、その分類に応じた暗号化・マスキング要件をテーブル仕様書に反映しなければならない。

**表15 — データ分類・マスキング方針**

| 項目 | 方針 |
|------|------|
| 情報分類 | セキュリティ方針書に従い付与する |
| 機微情報 | 暗号化保存＋表示時マスキングを必須とする |
| ログ出力 | アプリケーションログ方針書の出力ルールに従う |
| マスキング実装 | プロジェクション／ビューの項目定義に反映する |

#### 6.1.1 機微情報の保護

カード番号・口座番号・個人識別情報（氏名・生年月日等）は、画面・帳票・ログ出力時に必要最小限の桁のみ表示されるよう、プロジェクション／ビューの項目定義に反映しなければならない。

マスキング前の原データは、暗号化またはトークナイズされた形で保存することを基本とし、平文保存を行ってはならない。

**表16 — 機微情報保護要件**

| データ種別 | 保存方式 | 表示方式 |
|-----------|---------|---------|
| カード番号 | 暗号化またはトークナイズ | 下4桁のみ表示 |
| 暗証番号 | ハッシュ化 | 表示不可 |
| 個人識別情報 | 暗号化 | マスキング表示 |

### 6.2 アクセス制御・権限モデル

テーブル／ビューへのアクセスは、共通運用管理ドメインの組織・ユーザ管理で定義される権限モデルに基づき制御しなければならない。

**表17 — アクセス制御方針**

| 対象 | 方針 |
|------|------|
| 認可基盤 | 共通運用管理ドメイン（例）の組織・ユーザ管理を利用する |
| 行レベル権限制御 | 担当者・組織・テリトリ等の属性で制御可能なモデルとする |
| スキーマ権限制御 | BC単位にスキーマを分離し、不要な参照を防止する |

#### 6.2.1 行レベルセキュリティ

業務ユーザごとのアクセス範囲（顧客単位・加盟店単位等）は、データモデル上の組織単位／テリトリ等の属性と紐付けて設計しなければならない。

アプリケーション層での権限チェックだけに依存せず、必要に応じてビュー単位・スキーマ単位のアクセス制御を併用しなければならない。

### 6.3 監査証跡項目のモデリング

操作履歴・監査証跡は「アプリケーションログ方針書」「監査・業務ログ一覧」が主責であるが、業務データ側でも作成者／更新者／作成日時／更新日時等の最低限の監査項目を持たなければならない。

**表18 — 監査証跡方針**

| 項目 | 方針 |
|------|------|
| 作成者／更新者 | 全更新系テーブルで保持する |
| 変更内容の追跡 | 履歴テーブル＋監査ログの両方で追跡可能とする |
| 監査ログ連携 | アプリケーションログ方針書の定義に従う |

#### 6.3.1 監査項目の標準化

**表19 — 標準監査項目**

| カラム名 | データ型 | 説明 | 必須 |
|---------|---------|------|------|
| created_by | VARCHAR | 作成者ID | 必須 |
| created_at | TIMESTAMP | 作成日時 | 必須 |
| updated_by | VARCHAR | 更新者ID | 必須 |
| updated_at | TIMESTAMP | 更新日時 | 必須 |
| version | INT | 楽観ロック用バージョン | 推奨 |

改訂履歴を保持するテーブルでは、監査ログと合わせて誰が・いつ・どの値からどの値へ変更したかが追跡可能となるよう設計しなければならない。

監査証跡の保管期間・参照方法は、アプリケーションログ方針書との整合を取って定義しなければならない。

---

## 第7章 データライフサイクル・保管期間方針

### 7.1 データカテゴリ別ライフサイクル

データのライフサイクルは、ドメインスコープ定義書で定義された各ドメイン／サブドメインの責務に基づき、「生成→更新→参照→アーカイブ／削除」の流れを定義しなければならない。

**表20 — データライフサイクル**

| データカテゴリ | ライフサイクル上の主なステージ |
|---------------|------------------------------|
| 顧客／契約 | 申込→審査→契約→解約→保管終了 |
| カード発行 | 申込→発行→更新／再発行→解約→保管終了 |
| 売上・請求・入金 | 発生→確定→精算／回収→保管終了 |
| ポイント | 付与→利用→失効→保管終了 |

#### 7.1.1 ライフサイクル設計の原則

取引（売上・請求・入金・債権）データは、債権管理・会計統合・監査要件を満たす期間中は参照可能な状態を維持しなければならない。

ポイントやキャンペーンなどの補助データについても、関連する取引や会計処理に影響する期間は削除してはならない。

### 7.2 保管期間・アーカイブ・削除

各データカテゴリの保管期間は、法令・契約・社内規程に基づき「セキュリティ方針書」「運用要件定義書」で定義し、それを本書に反映しなければならない。

**表21 — 保管期間方針**

| 区分 | 方針 |
|------|------|
| 保管期間 | データカテゴリごとに年数等を別途定義する |
| アーカイブ | オンライン系DBから分離しつつ、検索・復元可能性を維持する |
| 削除 | 保管期間満了後のバッチ処理として実施する |

#### 7.2.1 アーカイブの実装

アーカイブによってオンライン系DBから退避したデータは、検索・復元に必要なキー情報を保持した状態で保存しなければならない。

保管期間満了後の削除処理は、バッチ一覧／バッチ仕様書で詳細を定めるものとし、その前提条件を本書で定義しなければならない。

**表22 — アーカイブ要件**

| 要件 | 説明 |
|------|------|
| キー情報保持 | 集約ID、業務キー等の検索用キーを保持する |
| 復元可能性 | 必要に応じてオンライン系に復元できる仕組みを用意する |
| 一貫性 | 関連データとの整合性を保ったままアーカイブする |

### 7.3 バックアップ・リストア観点の前提

バックアップ・リストア手順そのものはシステムIaC構成定義書等の範囲とするが、リストア後も論理キーで一意に業務データを識別できるようデータモデルを設計しなければならない。

**表23 — バックアップ・リストア前提**

| 項目 | 方針 |
|------|------|
| 論理キー | バックアップ／リストア後も変化しない識別子を採用する |
| 一貫性 | 履歴・監査テーブルとの整合が保てる粒度でバックアップする |
| 復旧可能性 | 集約単位で完全な復旧が可能なモデルとする |

履歴テーブル・監査ログとの整合が崩れないよう、バックアップ対象範囲とスキーマの整合条件をデータモデリング上の前提として定義しなければならない。

---

## 第8章 性能・スケーラビリティ考慮事項

### 8.1 インデックス設計方針

**表24 — インデックス設計方針**

| 項目 | 方針 |
|------|------|
| 主キー | 自動的にインデックスが作成される |
| 外部キー | 外部キーにはインデックスを作成することが望ましい |
| 検索条件 | 頻繁に検索条件として使用されるカラムにはインデックスを作成する |
| 複合インデックス | WHERE句で複数カラムを組み合わせる場合は複合インデックスを検討する |
| 過剰なインデックス | 更新性能への影響を考慮し、不要なインデックスは作成しない |

### 8.2 パーティショニング戦略

大量データを扱うテーブルについては、パーティショニングを検討しなければならない。

**表25 — パーティショニング方針**

| パーティション種別 | 適用場面 |
|------------------|---------|
| レンジパーティション | 日付範囲によるパーティション（取引履歴等） |
| リストパーティション | 特定の値によるパーティション（地域別等） |
| ハッシュパーティション | 均等な分散が必要な場合 |

### 8.3 非正規化の許容

CQRSパターンにおけるプロジェクションでは、参照性能を優先して非正規化を許容する。

ただし、非正規化したデータの更新は、必ず集約経由またはイベント駆動で行わなければならない。

---

## 付録A 未確定事項一覧

本方針書において「未確定」と記載された事項を以下にまとめる。これらは後続の検討・合意形成により確定させなければならない。

**表A.1 — 未確定事項一覧**

| 章節 | 項目 | 備考 |
|------|------|------|
| 7.2 | 各データカテゴリの保管期間具体値 | 法令・社内規程に基づき定義が必要 |
| 8.2 | パーティショニング対象テーブルの選定 | 性能要件に基づき個別判断が必要 |

---

## 付録B 検討が必要な論点

以下は、本方針書の運用にあたり検討が必要な論点である。

1. **データベース技術の選定**
   - RDB（Aurora MySQL等） vs NoSQL（DynamoDB等）の使い分け基準
   - BC単位での技術選定の許容範囲
   - イベントストアの導入可否

2. **BC間データ連携の詳細設計**
   - 参照用レプリケーションの許容範囲
   - マスタデータのBC間共有方式
   - 整合性保証の方法（イベント vs API）

3. **集約サイズの適正化**
   - 集約が大きくなりすぎる場合の分割基準
   - パフォーマンスと整合性のトレードオフ
   - 集約境界の見直しタイミング

4. **履歴データの扱い**
   - 履歴テーブルと現行テーブルの分離方式
   - 有効期間管理のパターン
   - 履歴データのクエリ性能最適化

5. **マルチテナント対応**
   - テナント分離方式（スキーマ分離 vs テーブル分離）
   - テナントIDの管理方法
   - データ分離の保証方法

6. **暗号化の実装方式**
   - アプリケーションレベル暗号化 vs DB暗号化
   - 鍵管理の方法
   - 暗号化対象カラムの選定基準

7. **プロジェクションの同期方式**
   - リアルタイム更新 vs バッチ更新
   - イベントソーシングの採用可否
   - 整合性遅延の許容範囲

8. **データ移行戦略**
   - レガシーシステムからの移行方式
   - ゼロダウンタイム移行の実現方法
   - データ検証・照合の方法

---
