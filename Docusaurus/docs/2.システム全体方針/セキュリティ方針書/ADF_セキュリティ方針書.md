あなたはセキュリティアーキテクト兼DDDを理解したシステムアーキテクトです。\
以下の【形式】および【ISO/IEC Directives Part 2準拠ルール】に基づいて、対象システムの「セキュリティ方針書」を作成してください。\
出力はすべてMarkdown形式で記載してください（JSON形式・CSV形式は禁止）。\
また、成果物（表・文章）の提示より先に、**必ず抽出・推論過程をstep-by-stepで記載**し、\
その後に章立てに沿って成果物を順序厳守で出力してください。\
推測による情報補完は禁止し、不明点は必ず「未確定」と明記してください。\
また、入力情報が不足している場合や検討が必要な論点がある場合は、文書の末尾に「Stop（入力不足に対する質問）」「論点（検討が必要な事項）」セクションを出力してください。

---

### 【形式】

章：`## 第1章 タイトル`\
節：`### 1.1 タイトル`\
項：`#### 1.1.1 タイトル`\
その他：通常テキスト\
表はMarkdown表形式で記載し、表番号とキャプションを付与する（例：`**表1 — 〇〇一覧**`）\
JSON / CSV形式は禁止

---

### 【ISO/IEC Directives Part 2準拠ルール】

#### 要求事項の表現
出力文書では以下の表現を使い分けること：

| 表現 | 用途 | 英語対応 |
|------|------|----------|
| 〜しなければならない | 要求事項 | shall |
| 〜してはならない | 禁止事項 | shall not |
| 〜することが望ましい | 推奨事項 | should |
| 〜しないほうがよい | 非推奨 | should not |
| 〜してもよい | 許可事項 | may |
| 〜できる | 可能性・能力 | can |

#### 文書構成の原則
- 要求事項と説明・解説を明確に区別すること
- 各章・節には目的を明示すること
- 表には連番とキャプションを付与すること

---

## 本ドキュメントの位置づけ

* 本書は、セキュリティに関する攻撃からどう守り、データをどう保護するか（Defense & Protection） を定義する
* 特に、**ID管理以外の防御壁（Guardrail）** に関する方針も本書の対象とする。
* 本書の内容は、以下の横断アーキテクチャ・非機能設計文書に拘束力を持つ：

**表1 — 本書の拘束対象**
| 対象文書 | 本書との関係 |
|------|--------|
| セキュリティ非機能要件定義書 | 技術レベル・暗号強度・応答時間・閾値を具体化 |
| ロギング／監査方針書 | 記録項目・保管期間・アクセス制御の設計 |
| API仕様書／画面仕様書／外部連携仕様書 | 本書で定めたセキュリティ原則に準拠 |
| システムIaC構成定義書／運用要件定義書 | インフラ・コンテナ・鍵管理などの実装詳細 |

---

## 本書のテーマ・対象範囲（Scope）

**テーマ：**

> 「攻撃からどう守り、データをどう保護するか」 (Defense & Protection)\
> ここには AuthN/AuthZ 以外の **防御壁（Guardrail）** が集約される。

**表2 — 防御対象カテゴリ**
| 防御対象カテゴリ | 内容例 |
|----------|-----|
| データ保護 | DB暗号化 (At Rest)、TLS、PIIマスキング、トークナイズ、ハッシュ化 |
| 脆弱性対策（Secure Coding） | SQL Injection、XSS、CSRF、入力検証、ログに機密を出さない |
| インフラセキュリティ | WAF、セキュリティグループ、ゼロトラスト、コンテナ権限、Secrets管理 |
| サプライチェーン | SBOM（依存管理）、脆弱性スキャン、OSSライセンス管理 |
| AIによる開発防御 | Linter・セキュリティ検閲、禁止事項チェック（生パスワード禁止等） |

---

## 第1章 適用範囲

### 1.1 目的

本書は、本システム全体に共通するセキュリティの基本方針および防御設計の原則（Defense & Protection）を定義することを目的とする。\
本書で定めた方針は、以下のドキュメントに対しアーキテクチャ上の拘束力を持つ。

* セキュリティ非機能要件定義書
* ロギング／監査方針書
* API仕様書／外部連携仕様書／画面仕様書
* IaC構成定義書／運用要件定義書

### 1.2 適用範囲

**表3 — 適用範囲**
| 項目 | 記載内容 |
|----|------|
| 適用範囲 | 本システムを構成するすべてのBC、API、画面、バッチ、インフラ、外部連携を対象とする |
| 除外範囲 | 未確定（例：他社管理の周辺システム内部実装など） |
| 関係者 | 開発者、運用者、監査担当、セキュリティ責任者、外部連携先 |

### 1.3 関連文書

**表4 — 関連文書一覧**
| 関連ドキュメント | 関係性 |
|----------------|--------|
| 認証・認可方針書 | 認証・認可方式の詳細を参照 |
| ロギング／監査方針書 | ログ・監査証跡の詳細を参照 |
| APIガバナンス方針書 | API層のセキュリティ実装を参照 |
| 非機能要件定義書 | セキュリティ非機能要件の具体値を参照 |

---

## 第2章 引用規格

本書は以下の規格・標準を参照する：

- ISO/IEC 27001:2022 情報セキュリティマネジメントシステム
- ISO/IEC 27002:2022 情報セキュリティ管理策
- NIST SP 800-53 Security and Privacy Controls
- OWASP Top 10

---

## 第3章 用語及び定義

本書で使用する主要な用語を以下に定義する：

**表5 — 用語定義**
| 用語 | 定義 |
|------|------|
| PII | Personally Identifiable Information（個人識別情報） |
| At Rest | 保存時（ストレージ上のデータ） |
| In Transit | 転送時（ネットワーク通信中のデータ） |
| トークナイズ | 機密データを非機密のトークンに置き換える処理 |
| WORM | Write Once Read Many（書き込み不可の改ざん防止ストレージ） |
| ゼロトラスト | ネットワーク境界に関わらず全ての通信を検証するセキュリティモデル |

---

## 第4章 セキュリティ基本原則（多層防御観点）

### 5.1 セキュリティ目標

本システムは以下のセキュリティ目標を達成しなければならない：

* 機密性（Confidentiality）
* 完全性（Integrity）
* 可用性（Availability）
* 責任追跡性（Accountability）
* 防御継続性（Resilience）

### 5.2 防御設計の原則（Defense-in-Depth）

**表6 — 防御設計の原則**
| 観点 | 方針 |
|----|----|
| 多層防御 | 複数の防御層（認証・API・WAF・通信・DB・監査）で保護しなければならない |
| ゼロトラスト | 信頼境界を設けず、全ての通信・操作を検証しなければならない |
| 最小権限 | すべてのアクセスは必要最小限としなければならない |
| 安全なデフォルト | Default Deny / Private を原則としなければならない |
| 侵害前提設計 | 「侵入される」ことを前提とし、検知・封じ込めを重視しなければならない |

---

## 第5章 認証・認可との関係整理（境界定義）

認証・認可方式そのものは「認証・認可方針書」に記載する。\
本書では、防御設計に関わる以下の内容のみ記載する。

**表7 — 本書で扱う認証・認可関連項目**
| 項目 | 本書で扱う観点 |
|----|---------|
| トークン保護 | 暗号化、漏洩時の失効、保管禁止、ログ禁止 |
| セッション保護 | 固定化・盗聴防止／Secure Cookie／HttpOnly |
| API権限制御 | レートリミット／API Gateway／WAF検知ブロック |

注：RBAC / ABAC / MFA / OAuth2.0 の方式定義は扱わない（認証・認可方針書で管理）

---

## 第6章 データ保護・プライバシー方針

### 7.1 データ分類

**表8 — データ分類**
| 区分 | 例 | 保護レベル |
|----|---|-------|
| 特定個人情報 | マイナンバー等 | 最高 |
| 決済機密情報 | カード番号／CVV | 最高 |
| 個人情報 | 氏名／住所／連絡先 | 高 |
| 与信審査情報 | 属性／スコア／申込履歴 | 高 |
| 業務情報 | マスタ／取引情報 | 中 |
| 公開情報 | 店舗一覧 等 | 低 |

### 7.2 暗号化・マスキング・トークナイズ方針

**表9 — 暗号化・マスキング・トークナイズ方針**
| 項目 | 方針 |
|----|----|
| 保存時暗号化 | DB / S3 / Backup に対して AES-256等で実施しなければならない |
| 通信時暗号化 | すべての通信経路をTLS1.3以上に統一しなければならない |
| マスキング | 画面・ログ・監査対象では機微情報をマスキングしなければならない |
| トークナイズ | PII・決済情報にはトークナイズを優先採用することが望ましい |
| ハッシュ化 | パスワードなど不可逆データはハッシュ保存しなければならない |
| ログ制御 | 生データ、トークン、鍵情報を記録してはならない |

---

## 第7章 インタフェース別セキュリティ方針

### 8.1 API

**表10 — APIセキュリティ方針**
| 観点 | 方針 |
|----|----|
| WAF | SQLi/XSS試行検知で即時遮断しなければならない |
| レート制限 | 外部API／公開APIにはレート制限を適用しなければならない |
| 入力検証 | 想定外／未定義形式は拒否しなければならない |
| 改ざん検知 | 署名付きリクエストを採用することが望ましい |

### 8.2 画面(UI)

**表11 — 画面セキュリティ方針**
| 観点 | 方針 |
|----|----|
| CSRF対策 | トークン制御を実施しなければならない |
| XSS対策 | エスケープ＋CSP設定を実施しなければならない |
| セッション管理 | Secure/HttpOnly/Cookie制御を実施しなければならない |
| スクリーンショット対策 | 機微情報画面ではマスキング等を実装することが望ましい |

### 8.3 外部連携

**表12 — 外部連携セキュリティ方針**
| 観点 | 方針 |
|----|----|
| 接続先検証 | 証明書・署名検証を実施しなければならない |
| データ最小化 | 最小限データのみ送信しなければならない |
| 依存サービスの脆弱性 | 定期スキャン・更新ルールを策定しなければならない |

---

## 第8章 開発／運用における防御方針（DevSecOps）

### 9.1 Secure Coding

**表13 — Secure Coding指針**
| 項目 | 指針 |
|----|----|
| SQL Injection | ORM使用／文字列結合を禁止しなければならない |
| XSS | 出力エスケープ／CSP設定を実施しなければならない |
| CSRF | Token方式を採用しなければならない |
| ログ | 生パスワード／機密出力を禁止しなければならない |
| 入力検証 | 型、長さ、形式、範囲制御を実施しなければならない |

### 9.2 サプライチェーン・AI開発防御

**表14 — サプライチェーン・AI開発防御方針**
| 項目 | 方針 |
|----|----|
| SBOM管理 | 使用OSS／依存関係は全て可視化しなければならない |
| 脆弱性スキャン | バージョン変更時・リリース前に実施しなければならない |
| AI Linter | セキュリティ禁則事項を自動チェックすることが望ましい |
| 秘密情報 | Git／ログ／AIチャット上で共有してはならない |

---

## 第9章 ログ・監査・証跡に関する方針

**表15 — ログ・監査・証跡方針**
| 観点 | 方針 |
|----|----|
| 記録対象 | 認証／認可／重要データアクセス／設定変更を記録しなければならない |
| ログ保護 | WORM／署名／アクセス制限を適用しなければならない |
| トレーサビリティ | 誰が／いつ／何にアクセスしたか記録しなければならない |
| 不正検知 | 合理的な閾値・異常検知ルールを定義しなければならない |

---

## Stop（入力不足に対する質問）

（入力情報が不足している場合、ここに質問を記載する）

---

## 論点（検討が必要な事項）

（検討が必要な論点がある場合、ここに記載する）
