あなたはセキュリティアーキテクト兼DDDを理解したシステムアーキテクトです。\
以下の【形式】に基づいて、対象システムの「テスト・品質保証方針書」を作成してください。\
出力はすべてMarkdown形式で記載してください（JSON形式・CSV形式は禁止）。\
また、成果物（表・文章）の提示より先に、必ず抽出・推論過程をstep-by-stepで記載し、\
その後に章立てに沿って成果物を順序厳守で出力してください。\
推測による情報補完は禁止し、不明点は必ず「未確定」と明記してください。

### 【形式】

第〇章：##\
〇.〇：###\
小見出し：####\
その他：通常テキスト\
表はMarkdown表形式で記載\
JSON / CSV形式は禁止

---

## 第1章：本書の位置付けと目的

### 1.1 本書の目的

本書は、ハウスクレジット基幹システムにおけるテストおよび品質保証（QA）の共通方針を定め、DDD／アジャイル開発を前提とした各BC・各スプリントのテスト活動に対するガードレールを示すことを目的とする。\
本書で定める方針は、以下のドキュメント・成果物に対して拘束力を持つ。

* テスト計画書（全体テスト計画・リリース単位テスト計画）
* シナリオテスト向けSBE（Gherkin等によるシナリオ定義）
* テストデータ設計・管理ドキュメント
* 各種仕様書（コマンド仕様書／クエリ仕様書／外部連携仕様書／画面仕様書 等）
* 非機能要件定義書／セキュリティ非機能要件定義書
* ロギング／監査方針書・監査・業務ログ一覧

本システムのプロダクトオーナー、開発チーム、QAチーム、運用チーム、および監査担当者は、本書の方針に従わなければならない。

---

## 第2章：入力情報と前提

### 2.1 入力アセット

以下の正式インプットを前提とする（添付資料に基づく）：

### 2.2 前提条件

* 本書で定義するテスト・品質保証方針は、プロジェクト計画書およびビジネスビジョンステートメントに基づき策定されることを前提とする。（未確定）
* 各BC（Bounded Context）の境界およびドメインモデル構造は、ドメイン定義書・ユビキタス言語定義書・イベントストーミング図を正とする。（未確定）
* トランザクション境界／Outbox／Saga／CQRS といったアーキテクチャ方針は、トランザクション方針書の定義内容に従う。（未確定）
* 非機能要件（性能・可用性・セキュリティ・監査等）の試験観点は、非機能要件定義書およびセキュリティ非機能要件定義書を基準とする。（未確定）
* テストデータ・環境構成・マスキングルールは、セキュリティ方針書／テストデータ管理方針に従って整備される。（未確定）
* 認証・認可・ログ・監査証跡に関するテスト観点は、「認証・認可方針書」および「ロギング／監査方針書」の内容を優先する。（未確定）
* CI/CD による自動テスト実行は標準前提とし、SBE・ユニットテスト・結合テスト・シナリオテストは CI 上で自動化されることを前提とする。（未確定）
* テスト環境は、本番相当の構成および依存サービス仕様が整備されていることを前提とする。（未確定）

---

## 第3章：テスト・品質保証の基本方針

### 3.1 品質目標とビジネス整合

本システムのテスト・品質保証は、ビジネスビジョンステートメントで定義されたKGI/KPIと整合する品質目標を達成しなければならない。\
テスト・QA活動は「会員登録→審査→決済→請求」などの主要ハッピーパスを、自動テストによる継続的な検証が可能な状態に維持しなければならない。\
品質目標は、機能品質・非機能品質・セキュリティ・運用性・監査対応性の観点から定義され、テスト計画書で具体化されなければならない。

### 3.2 DDD／BC前提のテストの考え方
| 観点 | 方針 |
|----|----|
| BC単位の独立性 | 各BCは独立したテスト単位として扱い、BC内部の整合性はBC内テストで完結させなければならない。 |
| ユビキタス言語 | テストケースおよびSBEはユビキタス言語に基づき記述し、業務担当者・開発者・QA間で意味の齟齬が発生しないようにしなければならない。 |
| 集約単位テスト | ドメインモデル・集約単位のテストを重視し、インフラ依存を排した高速な単体テストを整備しなければならない。 |
| BC間連携 | BC間連携はイベント駆動／Outbox/Saga方針に沿ってテストし、分散トランザクションに依存しない整合性確認を行わなければならない。 |

### 3.3 テストレベルと責任範囲
| テストレベル | 主な目的 | 主な責任者 | 方針 |
|--------|------|-------|----|
| 単体テスト | ドメインモデル・アプリケーションサービス単位のロジック検証 | 開発者 | 全てのビジネスロジックに対して単体テストを作成し、CIで自動実行しなければならない。 |
| 結合テスト（BC内） | BC内の複数コンポーネント間の連携検証 | 開発者／QA | リポジトリ／外部サービススタブを利用し、トランザクション方針に沿った整合性を検証しなければならない。 |
| BC間連携テスト | BC間のイベント連携・API連携検証 | QA | Outboxイベント／Saga／API経由の状態遷移をシナリオベースで検証しなければならない。 |
| システムテスト | 全BCを通した業務シナリオ検証 | QA | ビジネスビジョンの主要KPIに関わるシナリオを中心にSBEで定義し、テストを実施しなければならない。 |
| UAT | 利用者観点での受入判断 | 業務側／PO | 受入条件はSBEおよびテスト計画書を参照して明確化されなければならない。 |
| 非機能テスト | 性能・可用性・セキュリティ等の検証 | QA／SRE | 非機能要件定義書およびセキュリティ方針書に記載された要求を満たすことを確認しなければならない。 |

---

## 第4章：テストアーキテクチャ方針

### 4.1 トランザクション設計とテスト

テスト設計は、トランザクション方針書で定義されたユースケース単位のトランザクション境界を前提としなければならない。\
集約の一貫性を検証するテストは、1トランザクション内で更新される集約群を対象として設計しなければならない。\
BC間整合性の検証は、分散トランザクションではなく、イベント駆動／Sagaを用いた最終的整合性の観点から行わなければならない。

### 4.2 CQRS／読みモデルのテスト
| 観点 | 方針 |
|----|----|
| 書き込みモデル | 集約の不変条件・ビジネスルールを中心にテストしなければならない。 |
| 読みモデル | 投影ロジックと検索条件の正当性をテストしなければならない。 |
| 即時反映要件 | 残高照会等の即時反映が求められる読みモデルについては、書き込みトランザクションとの一貫性を検証するテストを整備しなければならない。 |
| 非同期更新 | Outbox経由で更新される読みモデルについては、遅延・再送・重複に対する冪等性テストを行わなければならない。 |

### 4.3 自動テスト・SBE・CI/CD方針

単体テスト・BC内結合テスト・SBEによるシナリオテストは、CIパイプラインの一部として自動実行されなければならない。\
SBEは、業務フローとユビキタス言語に基づいてテストシナリオを記述し、ビジネスビジョンのKGI/KPIに紐づけられなければならない。\
テストの自動化方針（対象レベル・優先順位）は、テスト計画書に詳細を記載し、本書の方針を上書きしてはならない。

### 4.4 テストデータ管理方針（アーキテクチャ観点）
| 観点 | 方針 |
|----|----|
| データ分離 | 開発／検証／本番環境のテストデータは物理的または論理的に分離され、本番データを開発環境で利用してはならない。 |
| マスキング | 本番由来データをテストに利用する必要がある場合は、セキュリティ方針書に沿って個人情報・決済情報をマスキングしなければならない。 |
| データ生成 | テストデータの生成ルール・パターンは「テストデータ」ドキュメントで管理し、本書では方針レベルに留める。 |
| 再現性 | 重要な不具合・事象を再現可能とするため、テストデータのバージョン管理を行わなければならない。 |

---

## 第5章：品質保証プロセス方針

### 5.1 スプリント単位の品質ゲート

ビジネスビジョンステートメントで定義されるスプリント運用・品質ゲートを踏まえ、各スプリントで以下を満たさなければならない。
| フェーズ | 必須品質ゲート（例） |
|------|------------|
| 企画・計画 | バックログアイテムごとに受入基準（SBEまたは明文化条件）が定義されていなければならない。 |
| 実装 | Lint／静的解析／依存ライブラリスキャンを通過しなければならない。 |
| テスト | 単体テスト・自動シナリオテストをCI上で完了していなければならない。 |
| レビュー | コードおよびAI生成物は少なくとも1名以上のレビューを経て承認されなければならない。 |
| リリース | テスト計画書で定義されたリリース基準を満たすまで、本番反映してはならない。 |

### 5.2 ロールと責任分担
| ロール | 主な責任 |
|-----|------|
| プロダクトオーナー | ビジネスビジョンに整合した品質目標と受入基準を定義しなければならない。 |
| 開発者 | 単体テスト・結合テスト・テスト可能な設計を実施しなければならない。 |
| QA | テスト計画書の策定・シナリオテストの設計／実行・欠陥管理を行わなければならない。 |
| SRE／運用 | 非機能テスト・運用観点の検証・監視項目とテスト観点の整合を図らなければならない。 |
| 監査担当者 | テスト証跡の確認・プロセス遵守状況の評価を行わなければならない。 |

---

## 第6章：欠陥管理・品質メトリクス方針

### 6.1 欠陥ライフサイクル

すべての欠陥はチケットとして登録され、受付〜解析〜修正〜再テスト〜クローズまでの状態遷移が定義されなければならない。\
重大度・優先度の定義と付与ルールを定め、KGI/KPIに影響する欠陥については優先的に対応しなければならない。\
本番環境で発生したインシデントは、欠陥チケットと紐づけられ、再発防止策まで含めて管理しなければならない。

### 6.2 品質メトリクスとレポーティング
| メトリクス種別 | 例 | 方針 |
|---------|---|----|
| 欠陥関連 | 欠陥件数／重大欠陥比率／再発率 等 | プロダクトまたはリリース単位で計測し、定期レビューを実施しなければならない。 |
| テスト実行 | テストケース数／実行率／合格率 等 | テスト計画書で定義されたカバレッジ要件に対して評価しなければならない。 |
| プロセス | テスト開始遅延／計画未消化率 等 | スプリントレトロスペクティブの材料として活用しなければならない。 |
| 非機能 | 性能テスト成功率／可用性検証結果 等 | 非機能要件定義書に対する達成状況として報告しなければならない。 |

---

## 第7章：テスト証跡・成果物管理方針

### 7.1 テスト成果物と保管対象
| 成果物種別 | 具体例 | 保管の要否 |
|-------|-----|-------|
| 計画系 | テスト計画書／テスト方針資料 | 保管対象 |
| 定義系 | SBEシナリオ／テストケース仕様書／テストデータ仕様 | 保管対象 |
| 実行系 | テスト実行結果レポート／CI実行ログ／テストサマリ | 保管対象 |
| 欠陥系 | 欠陥チケット／原因分析・対策記録 | 保管対象 |
| 証跡系 | スクリーンショット／ログ抜粋／DBスナップショット（必要最小限） | 保管対象（機微情報を含む場合はセキュリティ方針書に従う） |

### 7.2 保管期間

テスト成果物の保管期間は、監査要件および社内規程に基づき、テスト計画書または運用要件定義書にて定義されなければならない。\
保管期間を過ぎた成果物は、法令・規程に従い、適切に廃棄またはアーカイブされなければならない。

### 7.3 アクセス制御
| 観点 | 方針 |
|----|----|
| 権限管理 | テスト成果物へのアクセス権限は、組織・ユーザ管理に基づきロール単位で制御しなければならない。 |
| 匿名化 | テスト証跡内の個人情報・決済情報は必要最小限とし、可能な限り匿名化・マスキングを行わなければならない。 |
| 外部提供 | テスト成果物を外部へ提供する場合は、セキュリティ方針書および契約条件に基づき、事前承認を得なければならない。 |

### 7.4 改ざん防止・監査証跡

重要なテスト成果物（UAT結果・本番リリース判定記録 等）は、改ざん検知・防止が可能なストレージまたは仕組みに保管しなければならない。\
テスト成果物の閲覧・更新・削除など重要な操作については、誰が・いつ・何を行ったかが追跡可能な監査ログを記録しなければならない。\
これらのログ設計および保管は「ロギング／監査方針書」「監査・業務ログ一覧」と整合させなければならない。

---

## 第8章：トレーサビリティ方針

### 8.1 ビジネス要件・ドメイン要件とのトレーサビリティ

テストケースおよびSBEシナリオは、ビジネス要件（ビジネスビジョン・ドメインビジネスルール定義書等）と1対1または1対多の関係で紐づけられなければならない。\
テスト管理ツール上で、要件IDとテストケースIDの相互参照が可能でなければならない。

### 8.2 システム方針・非機能要件とのトレーサビリティ
| ドキュメント | 対応テスト観点 |
|--------|---------|
| セキュリティ方針書／セキュリティ非機能要件定義書 | 認証・認可・暗号化・ログマスキング・アクセス制御に関するテスト。 |
| トランザクション方針書 | トランザクション境界・Outbox・Saga・CQRSに関するテスト。 |
| 非機能要件定義書 | 性能・可用性・運用性・保守性に関するテスト。 |
| ロギング／監査方針書 | テスト証跡・監査ログ有無の確認。 |
| テスト計画書 | リリース単位のテストスコープ・優先順位。 |

### 8.3 ID体系

テストケース・SBEシナリオ・テスト成果物には一意なIDを付与し、バックログ項目および仕様書と紐づけられなければならない。