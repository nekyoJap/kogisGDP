---
id: ALPZZZZ001
title: アプリケーションログ方針書
sidebar_position: 1
---

# アプリケーションログ方針書

| 項目 | 内容 |
|------|------|
| ドキュメントID | ALPZZZZ001 |
| 版数 | 1.0 |
| 作成日 | 2026-01-14 |
| 最終更新日 | 2026-01-14 |
| ステータス | ドラフト |

---

## 第1章 適用範囲

### 1.1 目的

本書は、ハウスクレジット基幹システムにおけるアプリケーションログおよび監査ログの出力・管理・活用に関する共通方針を定めることを目的とする。

本書の対象は、アプリケーションレイヤーで出力されるログ全般であり、インフラレイヤーのログ（OSログ、ミドルウェアログ等）は対象外とする。

### 1.2 適用範囲

**表1 — 適用範囲**

| 項目 | 記述内容 |
|------|----------|
| 対象システム | ハウスクレジット基幹システム |
| 対象BC | ドメインスコープ定義書およびコンテキストマップに定義された全BC |
| 対象ログ | アプリケーションログ、監査ログ、業務ログ |
| 除外対象 | OSログ、ミドルウェアログ（運用要件定義書で管理） |

### 1.3 関連文書

**表2 — 関連文書一覧**

| 関連ドキュメント | 関係性 |
|------------------|--------|
| セキュリティ方針書 | PIIマスキング、改ざん防止方針を参照 |
| 例外処理ポリシー | 例外発生時のログ出力方針を参照 |
| ソフトウェアアーキテクチャ方針書 | レイヤ構成・責務配置を参照 |
| 運用要件定義書 | ログ保管期間・運用要件を参照 |

---

## 第2章 引用規格

本書は以下の規格・標準を参照する：

- ISO/IEC 27001:2022 情報セキュリティマネジメントシステム
- NIST SP 800-92 Guide to Computer Security Log Management
- RFC 5424 The Syslog Protocol

---

## 第3章 用語及び定義

**表3 — 用語定義**

| 用語 | 定義 |
|------|------|
| アプリケーションログ | アプリケーション層で出力される技術的なログ（デバッグ・障害調査用） |
| 監査ログ | セキュリティ・コンプライアンス目的で記録されるログ |
| 業務ログ | 業務処理の実行履歴・結果を記録するログ |
| トレースID | 分散システム全体で一意にリクエストを追跡するID |
| スパンID | トレース内の個別処理単位を識別するID |
| PII | Personally Identifiable Information（個人識別情報） |
| マスキング | 機微情報を保護するため、一部または全部を隠蔽する処理 |

---

## 第4章 ログ分類方針

### 4.1 ログ種別定義

本システムでは、目的と用途に応じて以下のログ種別を定義する。

**表4 — ログ種別定義**

| 種別 | 目的 | 主な用途 | 想定利用者 |
|------|------|----------|-----------|
| アプリケーションログ | 技術的なデバッグ・障害調査 | エラー発生箇所の特定、パフォーマンス分析 | 開発者・運用者 |
| 監査ログ | セキュリティ監査・コンプライアンス | 不正アクセス検知、操作履歴の追跡 | 監査担当・セキュリティ担当 |
| 業務ログ | 業務処理の追跡・確認 | 業務フロー確認、顧客問合せ対応 | 業務担当者 |

### 4.2 ログレベル定義

アプリケーションログのレベルは、以下の通り定義しなければならない。

**表5 — ログレベル定義**

| レベル | 用途 | 出力条件 | 例 |
|--------|------|----------|-----|
| FATAL | システム継続不能な障害 | 本番環境で必須 | データベース接続不可、メモリ枯渇 |
| ERROR | エラー発生（処理継続可能） | 本番環境で必須 | API呼び出し失敗、バリデーションエラー |
| WARN | 警告（潜在的問題） | 本番環境で必須 | 推奨されない使用方法、リトライ発生 |
| INFO | 重要な業務イベント | 本番環境で必須 | 処理開始・完了、状態遷移 |
| DEBUG | デバッグ情報 | 開発・検証環境のみ | 変数値、処理フロー詳細 |
| TRACE | 詳細トレース | 開発環境のみ | メソッド呼び出し、ループ処理詳細 |

---

## 第5章 ログ出力方針

### 5.1 レイヤ別ログ出力方針

クリーンアーキテクチャの各レイヤーにおけるログ出力方針を以下に定める。

**表6 — レイヤ別ログ出力方針**

| レイヤ | ログ出力方針 | 理由 |
|--------|-------------|------|
| アダプタ層（Controllers/Presenters） | 入口／出口ログを出力しなければならない | 外部とのインタフェース境界でリクエスト・レスポンスを記録 |
| ユースケース層（Application Services） | 業務処理の開始・完了・失敗を出力しなければならない | ビジネストランザクションの追跡 |
| エンティティ層（Domain Entities） | ログを出力してはならない | 純粋なドメインロジックを保つため |
| 外部フレームワークとドライバー | 外部連携の結果・エラーを出力しなければならない | 外部システムとの連携状況を記録 |

### 5.2 必須出力項目

すべてのアプリケーションログは、以下の項目を含まなければならない。

**表7 — 必須出力項目**

| 項目 | 説明 | 必須/推奨 | フォーマット例 |
|------|------|-----------|---------------|
| timestamp | 出力日時 | 必須 | ISO 8601形式（例：2026-01-14T18:16:44+09:00） |
| level | ログレベル | 必須 | FATAL/ERROR/WARN/INFO/DEBUG/TRACE |
| traceId | トレースID | 必須 | UUID形式（例：550e8400-e29b-41d4-a716-446655440000） |
| spanId | スパンID | 推奨 | UUID形式 |
| userId | 操作ユーザーID | 必須（認証後） | システム内部ID |
| bcName | BC名 | 必須 | 例：売上確定BC、請求BC |
| serviceName | サービス名 | 必須 | 例：SalesConfirmationService |
| message | ログメッセージ | 必須 | 人間可読なメッセージ |
| context | 追加コンテキスト情報 | 任意 | JSON形式の追加情報 |
| errorCode | エラーコード | エラー時必須 | システム定義のエラーコード |

### 5.3 ログ出力タイミング

**表8 — ログ出力タイミング**

| タイミング | 出力すべき内容 | ログレベル |
|-----------|---------------|-----------|
| 処理開始時 | 処理名、入力パラメータ（マスキング済み） | INFO |
| 処理完了時 | 処理名、実行時間、主要な結果 | INFO |
| エラー発生時 | エラー内容、スタックトレース、関連コンテキスト | ERROR/FATAL |
| 外部API呼び出し前 | 呼び出し先、リクエスト概要 | INFO/DEBUG |
| 外部API呼び出し後 | レスポンス概要、ステータスコード、実行時間 | INFO/DEBUG |
| データベースアクセス前後 | SQL概要（未確定）、実行時間 | DEBUG |
| 状態遷移時 | 遷移前後の状態、遷移理由 | INFO |

---

## 第6章 監査ログ方針

### 6.1 監査対象イベント

セキュリティおよびコンプライアンス要件に基づき、以下のイベントを監査ログとして記録しなければならない。

**表9 — 監査対象イベント**

| イベント種別 | 具体例 | 記録理由 |
|------------|--------|----------|
| 認証イベント | ログイン、ログアウト、認証失敗、セッションタイムアウト | 不正アクセス検知 |
| 認可イベント | 権限変更、アクセス拒否、ロール割当 | 権限管理の追跡 |
| データアクセス | 機微情報（カード番号、口座情報等）の参照・更新 | 情報漏洩リスク管理 |
| 設定変更 | システム設定の変更、マスタデータ更新 | システム整合性の保証 |
| 管理操作 | ユーザー作成・削除、権限付与・剥奪 | 管理操作の追跡 |
| 重要業務処理 | 審査承認、カード発行、請求確定、入金処理 | 業務監査 |

### 6.2 監査ログ必須項目

監査ログは、以下の項目を含まなければならない。

**表10 — 監査ログ必須項目**

| 項目 | 説明 | 例 |
|------|------|-----|
| eventType | イベント種別 | LOGIN, LOGOUT, DATA_ACCESS, CONFIG_CHANGE |
| timestamp | 発生日時（ISO 8601形式） | 2026-01-14T18:16:44+09:00 |
| userId | 操作ユーザーID | USER12345 |
| userName | 操作ユーザー名（マスキング考慮） | 山田太郎 |
| targetResource | 対象リソース | /api/customers/12345, CardTable |
| action | 実行アクション | READ, UPDATE, DELETE, CREATE |
| result | 結果（成功/失敗） | SUCCESS, FAILURE |
| resultDetail | 結果詳細 | 成功理由、失敗理由 |
| sourceIP | 接続元IPアドレス | 192.168.1.100 |
| userAgent | ユーザーエージェント | Mozilla/5.0... |
| bcName | BC名 | 売上確定BC |
| traceId | トレースID | UUID |

### 6.3 監査ログ出力場所

監査ログは、アプリケーションログとは分離して出力しなければならない。具体的な出力先（専用テーブル、ログストリーム等）は未確定とし、運用要件定義で確定する。

---

## 第7章 PIIマスキング方針

### 7.1 マスキング対象

個人識別情報（PII）および機微情報は、ログ出力時に必ずマスキングしなければならない。

**表11 — マスキング対象と方式**

| 対象データ | マスキング方式 | 例 |
|----------|---------------|-----|
| カード番号（16桁） | 先頭6桁＋末尾4桁以外をマスク | 123456******7890 |
| 口座番号 | 末尾4桁以外をマスク | *******1234 |
| 氏名 | 完全マスク | *** |
| 電話番号 | 末尾4桁以外をマスク | ***-****-5678 |
| メールアドレス | ローカル部をマスク、ドメインは保持 | ***@example.com |
| パスワード | 出力禁止 | （出力しない） |
| 住所 | 市区町村レベルまで、番地以降をマスク | 東京都千代田区*** |
| 生年月日 | 年のみ表示 | 1990-**-** |

### 7.2 マスキング実装方針

**表12 — マスキング実装方針**

| 項目 | 方針 |
|------|------|
| 実装箇所 | ログ出力の共通ライブラリ・ミドルウェアで一元的に実施しなければならない |
| 実装タイミング | ログ出力直前にマスキング処理を適用しなければならない |
| 例外処理 | マスキング処理が失敗した場合、該当データの出力を抑止しなければならない |
| 監査 | マスキング前のデータをログに出力してはならない |
| テスト | マスキング処理の有効性を定期的にテストしなければならない |

### 7.3 マスキング除外条件

以下の場合に限り、マスキングを除外してもよい：

- 専用の暗号化ログストレージに出力する場合（セキュリティ方針書の要件を満たすこと）
- 法的要件により完全な情報が必要な場合（監査ログの一部）
- ただし、除外する場合は必ずセキュリティレビューを通過しなければならない

---

## 第8章 ログ保管・保護方針

### 8.1 保管期間

ログの保管期間は、法規制、監査要件、業務要件に基づいて定める。

**表13 — 保管期間**

| ログ種別 | 保管期間 | 備考 |
|---------|---------|------|
| アプリケーションログ | 未確定 | 運用要件定義書で確定。障害調査期間を考慮 |
| 監査ログ | 未確定 | 法規制・監査要件に従う。最低7年以上を想定 |
| 業務ログ | 未確定 | 業務要件に従う。請求・債権管理期間を考慮 |

### 8.2 保護方針

ログの改ざん防止およびアクセス制御を実施しなければならない。

**表14 — 保護方針**

| 項目 | 方針 |
|------|------|
| アクセス制御 | ロールベースアクセス制御（RBAC）を実施しなければならない |
| 改ざん防止 | WORM（Write Once Read Many）ストレージまたは電子署名による改ざん検知を検討することが望ましい |
| 暗号化（保管時） | 保管時暗号化を実施しなければならない |
| 暗号化（転送時） | ログ転送時はTLS等で暗号化しなければならない |
| バックアップ | 定期的なバックアップを実施しなければならない |
| 削除 | 保管期間経過後は安全に削除しなければならない |

### 8.3 アクセス権限管理

**表15 — アクセス権限管理**

| ロール | アプリケーションログ | 監査ログ | 業務ログ |
|-------|-------------------|---------|---------|
| 開発者 | 開発・検証環境：読取可 / 本番環境：不可 | 不可 | 不可 |
| 運用者 | 読取可 | 不可 | 読取可 |
| セキュリティ担当 | 読取可 | 読取可 | 読取可（必要最小限） |
| 監査担当 | 読取可（必要最小限） | 読取可 | 読取可（必要最小限） |
| 業務担当 | 不可 | 不可 | 読取可（所管範囲のみ） |

---

## 第9章 分散トレーシング方針

### 9.1 トレースIDの伝播

分散システムにおいて、リクエストをエンドツーエンドで追跡するため、トレースIDを伝播しなければならない。

**表16 — トレースID伝播方針**

| 項目 | 方針 |
|------|------|
| トレースID生成 | システム入口（API Gateway、BFF等）でトレースIDを生成しなければならない |
| トレースID形式 | UUID v4形式を使用しなければならない |
| 伝播方法 | HTTP通信ではヘッダー（X-Trace-ID等）、メッセージングではメッセージプロパティで伝播しなければならない |
| BC間伝播 | すべてのBC間通信でトレースIDを伝播しなければならない |
| 外部システム連携 | 外部システムへの連携時もトレースIDを伝播することが望ましい |

### 9.2 スパンIDの利用

トレース内の個別処理単位を識別するため、スパンIDを利用することが望ましい。

**表17 — スパンID利用方針**

| 項目 | 方針 |
|------|------|
| スパンID生成 | 各処理単位（ユースケース、外部API呼び出し等）でスパンIDを生成してもよい |
| 親子関係 | 親スパンIDを保持し、処理の階層構造を表現することが望ましい |

### 9.3 分散トレーシングツール

分散トレーシングツールの導入は未確定とする。導入する場合は、以下を検討しなければならない。

**表18 — 分散トレーシングツール検討事項**

| 検討事項 | 内容 |
|---------|------|
| ツール選定 | OpenTelemetry、AWS X-Ray、Jaeger等から選定 |
| サンプリング戦略 | 本番環境ではサンプリング率を設定し、パフォーマンス影響を最小化してもよい |
| 可視化 | トレース情報を可視化し、ボトルネック分析を可能にすることが望ましい |
| コスト | ツール導入・運用コストを考慮しなければならない |

---

## 第10章 ログフォーマット方針

### 10.1 ログフォーマット標準

ログフォーマットは、構造化ログ（JSON形式）を採用することが望ましい。

**表19 — ログフォーマット方針**

| 項目 | 方針 |
|------|------|
| フォーマット | JSON形式を推奨 |
| エンコーディング | UTF-8を使用しなければならない |
| タイムゾーン | JST（Asia/Tokyo）を使用しなければならない |
| 改行 | 1ログエントリ = 1行として出力しなければならない |

### 10.2 JSON形式サンプル

```json
{
  "timestamp": "2026-01-14T18:16:44+09:00",
  "level": "INFO",
  "traceId": "550e8400-e29b-41d4-a716-446655440000",
  "spanId": "6ba7b810-9dad-11d1-80b4-00c04fd430c8",
  "userId": "USER12345",
  "bcName": "売上確定BC",
  "serviceName": "SalesConfirmationService",
  "message": "売上確定処理を開始しました",
  "context": {
    "salesId": "SALES20260114001",
    "amount": 10000,
    "merchantId": "MERCHANT001"
  }
}
```

---

## 第11章 エラーログ方針

### 11.1 エラーログ必須情報

エラー発生時のログには、以下の情報を含まなければならない。

**表20 — エラーログ必須情報**

| 項目 | 説明 |
|------|------|
| errorCode | システム定義のエラーコード |
| errorMessage | エラーメッセージ（人間可読） |
| stackTrace | スタックトレース（開発・検証環境） |
| errorContext | エラー発生時のコンテキスト情報 |
| recoveryAction | 推奨される復旧アクション |
| relatedTraceId | 関連するトレースID |

### 11.2 例外処理とログの連携

例外処理ポリシーと連携し、以下の方針を採用しなければならない。

**表21 — 例外処理とログの連携**

| 例外種別 | ログレベル | 出力内容 |
|---------|-----------|---------|
| ビジネス例外 | WARN | エラーコード、エラーメッセージ、ビジネスコンテキスト |
| システム例外 | ERROR | エラーコード、エラーメッセージ、スタックトレース、システムコンテキスト |
| 致命的例外 | FATAL | エラーコード、エラーメッセージ、スタックトレース、全コンテキスト、復旧不可能理由 |
| 外部システム例外 | ERROR | 外部システム名、エラーコード、レスポンス内容、リトライ状況 |

---

## 第12章 パフォーマンス考慮事項

### 12.1 ログ出力のパフォーマンス影響

ログ出力がシステムパフォーマンスに与える影響を最小化しなければならない。

**表22 — パフォーマンス考慮事項**

| 項目 | 方針 |
|------|------|
| 非同期出力 | ログ出力は非同期で行い、業務処理をブロックしないことが望ましい |
| バッファリング | ログバッファリングを適切に設定し、I/O回数を削減することが望ましい |
| ログレベル制御 | 本番環境ではDEBUG/TRACEレベルを無効化しなければならない |
| 大量データ | 大量データをログに出力する場合は、要約または省略を検討しなければならない |
| サンプリング | 高頻度ログはサンプリング出力を検討してもよい |

### 12.2 ログローテーション

ログファイルのローテーション方針を定めなければならない。

**表23 — ログローテーション方針**

| 項目 | 方針 |
|------|------|
| ローテーション基準 | ファイルサイズまたは日次でローテーションしなければならない |
| ファイル名規則 | タイムスタンプを含む命名規則を採用しなければならない |
| 圧縮 | ローテーション後のログファイルは圧縮することが望ましい |
| 削除ポリシー | 保管期間を超えたログファイルは自動削除しなければならない |

---

## 第13章 ログ監視・アラート方針

### 13.1 監視対象

以下のログパターンを監視し、異常検知時にアラートを発報しなければならない。

**表24 — 監視対象とアラート条件**

| 監視対象 | アラート条件 | アラートレベル |
|---------|-------------|--------------|
| ERRORログ | 閾値を超えるERRORログ発生 | 高 |
| FATALログ | FATALログ発生 | 緊急 |
| 認証失敗 | 短時間での複数回認証失敗 | 高 |
| アクセス拒否 | 不正なアクセス試行の検知 | 高 |
| パフォーマンス劣化 | 処理時間が閾値を超過 | 中 |
| 外部システムエラー | 外部システム連携の連続失敗 | 高 |

### 13.2 アラート通知

**表25 — アラート通知方針**

| 項目 | 方針 |
|------|------|
| 通知先 | 運用チーム、セキュリティチーム等、アラートレベルに応じて通知先を設定しなければならない |
| 通知手段 | Email、Slack、SMS等、複数手段を組み合わせることが望ましい |
| エスカレーション | 一定時間対応がない場合、エスカレーションルールに従わなければならない |

---

## 第14章 ログ分析・活用方針

### 14.1 ログ分析ツール

ログ分析ツールの導入は未確定とする。導入する場合は、以下を検討しなければならない。

**表26 — ログ分析ツール検討事項**

| 検討事項 | 内容 |
|---------|------|
| ツール選定 | ELKスタック、Splunk、AWS CloudWatch Logs Insights等から選定 |
| 集約方法 | 分散したログを一元的に集約する仕組みを検討 |
| 検索性能 | 大量ログからの高速検索を実現 |
| ダッシュボード | KPI・メトリクスを可視化するダッシュボードを作成することが望ましい |

### 14.2 ログ活用シナリオ

**表27 — ログ活用シナリオ**

| シナリオ | 活用内容 |
|---------|---------|
| 障害調査 | トレースIDによるエンドツーエンドの処理追跡 |
| パフォーマンス分析 | 処理時間・ボトルネックの特定 |
| セキュリティ監査 | 不正アクセス・権限変更の追跡 |
| 業務監査 | 重要業務処理の実行履歴確認 |
| ユーザーサポート | 顧客問合せ時の処理状況確認 |
| システム改善 | エラー傾向分析・予防保守 |

---

## 付録A 未確定事項一覧

本方針書において「未確定」と記載された事項を以下にまとめる。これらは後続の検討・合意形成により確定させなければならない。

**表A.1 — 未確定事項一覧**

| 章節 | 項目 | 備考 |
|------|------|------|
| 5.3 | データベースアクセスログのSQL出力可否 | セキュリティ方針との整合、パフォーマンス影響を考慮して決定 |
| 6.3 | 監査ログの具体的な出力先 | 専用テーブル、ログストリーム等の技術選定が必要 |
| 8.1 | アプリケーションログ保管期間 | 障害調査期間を考慮した具体的期間の策定が必要 |
| 8.1 | 監査ログ保管期間 | 法規制・監査要件に基づく具体的期間の策定が必要 |
| 8.1 | 業務ログ保管期間 | 業務要件に基づく具体的期間の策定が必要 |
| 9.3 | 分散トレーシングツールの導入可否 | 技術選定・コスト評価が必要 |
| 13.1 | 監視アラート閾値の具体値 | ERRORログ発生率、処理時間閾値等の具体値策定が必要 |
| 13.2 | アラートエスカレーションの具体的時間 | 運用体制に基づく策定が必要 |
| 14.1 | ログ分析ツールの導入可否 | 技術選定・コスト評価が必要 |

---

## 付録B 検討が必要な論点

以下は、本方針書の運用にあたり検討が必要な論点である。

1. **ログ出力共通ライブラリの開発**
   - 全BC共通で使用するログ出力ライブラリの開発・提供
   - PIIマスキング機能の実装
   - トレースID/スパンIDの自動付与機能

2. **ログ基盤の構築**
   - ログ集約基盤（例：ELKスタック、CloudWatch Logs等）の選定・構築
   - ログストレージの容量計画
   - ログ転送の信頼性確保

3. **監査ログの法的要件確認**
   - 金融業界の法規制（個人情報保護法、犯罪収益移転防止法等）の確認
   - 監査要件の明確化
   - 保管期間の法的根拠の確認

4. **開発者向けガイドライン作成**
   - ログ出力のベストプラクティス集
   - ログメッセージの書き方ガイド
   - トラブルシューティング時のログ活用方法

5. **運用プロセスの整備**
   - ログ監視体制の構築
   - アラート対応手順の策定
   - ログ分析・レポート作成プロセス

6. **コスト管理**
   - ログストレージコストの見積もり・予算化
   - ログ保管期間とコストのトレードオフ検討
   - ログサンプリング戦略の検討

7. **プライバシー保護の強化**
   - GDPRやその他のプライバシー規制への対応
   - 個人データの削除要求への対応方法
   - マスキング処理の妥当性検証

---
